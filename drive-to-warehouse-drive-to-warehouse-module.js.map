{"version":3,"sources":["./src/pages/main/drive-to-warehouse/drive-to-warehouse.html","./src/pages/main/drive-to-warehouse/drive-to-warehouse.module.ts","./src/pages/main/drive-to-warehouse/drive-to-warehouse.ts"],"names":[],"mappings":"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","file":"drive-to-warehouse-drive-to-warehouse-module.js","sourcesContent":["export default \"<carrier-map #map class=\\\"map\\\"></carrier-map>\\n\\n<div class=\\\"bottom-container\\\">\\n\\t<div class=\\\"info\\\">\\n\\t\\t<span class=\\\"left-info\\\">To: {{ selectedOrder?.user.fullAddress }}</span>\\n\\t\\t<span class=\\\"right-text\\\">{{ carrierUserDistance + 'km' }}</span>\\n\\t</div>\\n\\t<div class=\\\"buttons\\\">\\n\\t\\t<div\\n\\t\\t\\tclass=\\\"button-bar\\\"\\n\\t\\t\\t*ngIf=\\\"!workTaken && !selectedOrder?.isCancelled\\\"\\n\\t\\t>\\n\\t\\t\\t<button class=\\\"button button-brand\\\" (click)=\\\"takeWork()\\\">\\n\\t\\t\\t\\t{{ 'DRIVE_TO_WAREHOUSE_VIEW.TAKE_WORK' | translate }}\\n\\t\\t\\t</button>\\n\\n\\t\\t\\t<button class=\\\"button button-assertive\\\" (click)=\\\"skipWork()\\\">\\n\\t\\t\\t\\t{{ 'DRIVE_TO_WAREHOUSE_VIEW.SKIP_WORK' | translate }}\\n\\t\\t\\t</button>\\n\\t\\t</div>\\n\\t\\t<div\\n\\t\\t\\tclass=\\\"button-bar\\\"\\n\\t\\t\\t*ngIf=\\\"workTaken && (!selectedOrder?.isCancelled || fromDelivery)\\\"\\n\\t\\t>\\n\\t\\t\\t<button class=\\\"button button-brand\\\" (click)=\\\"carrierInWarehouse()\\\">\\n\\t\\t\\t\\t{{ \\\"DRIVE_TO_WAREHOUSE_VIEW.I'M_THERE\\\" | translate }}\\n\\t\\t\\t</button>\\n\\n\\t\\t\\t<button\\n\\t\\t\\t\\tclass=\\\"button button-assertive\\\"\\n\\t\\t\\t\\t*ngIf=\\\"!selectedOrder.isCancelled\\\"\\n\\t\\t\\t\\t(click)=\\\"cancelWork()\\\"\\n\\t\\t\\t>\\n\\t\\t\\t\\t{{ 'DRIVE_TO_WAREHOUSE_VIEW.CANCEL' | translate }}\\n\\t\\t\\t</button>\\n\\t\\t</div>\\n\\t\\t<div\\n\\t\\t\\tclass=\\\"button-bar\\\"\\n\\t\\t\\t*ngIf=\\\"selectedOrder?.isCancelled && !fromDelivery\\\"\\n\\t\\t>\\n\\t\\t\\t<button class=\\\"button button-assertive\\\" (click)=\\\"unselectOrder()\\\">\\n\\t\\t\\t\\t{{ 'OK' | translate }}\\n\\t\\t\\t</button>\\n\\t\\t</div>\\n\\t</div>\\n</div>\\n\"","import { NgModule } from '@angular/core';\nimport { DriveToWarehousePage } from './drive-to-warehouse';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { Geolocation } from '@ionic-native/geolocation/ngx';\nimport { GeoLocationService } from '../../../services/geo-location.service';\nimport { IonicModule } from '@ionic/angular';\nimport { CommonModule } from '@angular/common';\nimport { Routes, RouterModule } from '@angular/router';\nimport { MapModule } from '../common/map/map.module';\n\nconst routes: Routes = [\n\t{\n\t\tpath: '',\n\t\tcomponent: DriveToWarehousePage,\n\t},\n];\n\n@NgModule({\n\tdeclarations: [DriveToWarehousePage],\n\timports: [\n\t\tIonicModule,\n\t\tCommonModule,\n\t\tTranslateModule.forChild(),\n\t\tRouterModule.forChild(routes),\n\t\tMapModule,\n\t],\n\tproviders: [Geolocation, GeoLocationService],\n})\nexport class DriveToWarehousePageModule {}\n","import { Component, ViewChild, OnInit } from '@angular/core';\n\nimport IOrder from '@modules/server.common/interfaces/IOrder';\nimport { OrderRouter } from '@modules/client.common.angular2/routers/order-router.service';\nimport Utils from '@modules/server.common/utils';\nimport ICarrier from '@modules/server.common/interfaces/ICarrier';\nimport { CarrierRouter } from '@modules/client.common.angular2/routers/carrier-router.service';\nimport GeoLocation from '@modules/server.common/entities/GeoLocation';\nimport OrderCarrierStatus from '@modules/server.common/enums/OrderCarrierStatus';\nimport { CarrierOrdersRouter } from '@modules/client.common.angular2/routers/carrier-orders-router.service';\nimport { Store } from '../../../services/store.service';\nimport { Geolocation } from '@ionic-native/geolocation/ngx';\nimport IGeoLocation from '@modules/server.common/interfaces/IGeoLocation';\nimport { GeoLocationService } from '../../../services/geo-location.service';\nimport { MapComponent } from '../common/map/map.component';\nimport { Router } from '@angular/router';\nimport { NavController } from '@ionic/angular';\n\ndeclare var google: any;\n\n@Component({\n\tselector: 'page-drive-to-warehouse',\n\ttemplateUrl: 'drive-to-warehouse.html',\n})\nexport class DriveToWarehousePage implements OnInit {\n\t@ViewChild('map')\n\tcarrierMap: MapComponent;\n\n\tselectedOrder: IOrder;\n\tcarrier: ICarrier;\n\tcarrierUserDistance: string;\n\tworkTaken: boolean;\n\tfromDelivery: boolean;\n\n\tcarrier$;\n\torder$;\n\n\tconstructor(\n\t\tprivate orderRouter: OrderRouter,\n\t\tprivate carrierRouter: CarrierRouter,\n\t\tprivate carrierOrdersRouter: CarrierOrdersRouter,\n\t\tprivate store: Store,\n\t\tprivate geoLocationService: GeoLocationService,\n\t\tprivate geolocation: Geolocation,\n\t\tprivate router: Router,\n\t\tprivate navCtrl: NavController\n\t) {}\n\n\tngOnInit(): void {\n\t\tthis.fromDelivery = this.store.driveToWarehouseFrom === 'delivery';\n\t}\n\n\tionViewWillEnter() {\n\t\tthis.carrier$ = this.carrierRouter\n\t\t\t.get(this.store.carrierId)\n\t\t\t.subscribe(async (c) => {\n\t\t\t\tthis.carrier = c;\n\n\t\t\t\tconst position = this.geoLocationService.defaultLocation()\n\t\t\t\t\t? this.geoLocationService.defaultLocation()\n\t\t\t\t\t: await this.geolocation.getCurrentPosition();\n\n\t\t\t\t// MongoDb store coordinates lng => lat\n\t\t\t\tlet dbGeoInput = {\n\t\t\t\t\tloc: {\n\t\t\t\t\t\ttype: 'Point',\n\t\t\t\t\t\tcoordinates: [\n\t\t\t\t\t\t\tposition.coords.longitude,\n\t\t\t\t\t\t\tposition.coords.latitude,\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t} as IGeoLocation;\n\n\t\t\t\tif (this.order$) {\n\t\t\t\t\tawait this.order$.unsubscribe();\n\t\t\t\t}\n\n\t\t\t\tconst orderId = localStorage.getItem('orderId');\n\t\t\t\tif (orderId) {\n\t\t\t\t\tthis.order$ = this.orderRouter\n\t\t\t\t\t\t.get(orderId, {\n\t\t\t\t\t\t\tpopulateWarehouse: true,\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.subscribe((order) => {\n\t\t\t\t\t\t\tthis.selectedOrder = order;\n\t\t\t\t\t\t\tthis.store.selectedOrder = order;\n\t\t\t\t\t\t\tthis.workTaken =\n\t\t\t\t\t\t\t\torder.carrierStatus !==\n\t\t\t\t\t\t\t\tOrderCarrierStatus.NoCarrier;\n\n\t\t\t\t\t\t\tconst origin = new google.maps.LatLng(\n\t\t\t\t\t\t\t\tposition.coords.latitude,\n\t\t\t\t\t\t\t\tposition.coords.longitude\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tconst merchantGeo = order.warehouse['geoLocation'];\n\n\t\t\t\t\t\t\tthis.carrierUserDistance = Utils.getDistance(\n\t\t\t\t\t\t\t\tmerchantGeo,\n\t\t\t\t\t\t\t\tdbGeoInput as GeoLocation\n\t\t\t\t\t\t\t).toFixed(2);\n\n\t\t\t\t\t\t\tconst destination = new google.maps.LatLng(\n\t\t\t\t\t\t\t\tmerchantGeo.loc.coordinates[1],\n\t\t\t\t\t\t\t\tmerchantGeo.loc.coordinates[0]\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tthis.carrierMap.setCenter(origin);\n\t\t\t\t\t\t\tthis.carrierMap.drawRoute(origin, destination);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tasync takeWork() {\n\t\tif (this.carrier && this.selectedOrder) {\n\t\t\treturn await this.carrierOrdersRouter.selectedForDelivery(\n\t\t\t\tthis.carrier['id'],\n\t\t\t\t[this.selectedOrder['id']]\n\t\t\t);\n\t\t} else {\n\t\t\t// TODO: replace with some popup\n\t\t\talert('Try again!');\n\t\t}\n\t}\n\n\tasync skipWork() {\n\t\tif (this.carrier && this.selectedOrder) {\n\t\t\tawait this.carrierOrdersRouter.skipOrders(this.carrier['id'], [\n\t\t\t\tthis.selectedOrder['id'],\n\t\t\t]);\n\n\t\t\tthis.unselectOrder();\n\t\t}\n\t}\n\n\tasync carrierInWarehouse() {\n\t\tif (this.fromDelivery) {\n\t\t\tthis.store.returnProductFrom = 'driveToWarehouse';\n\n\t\t\tthis.router.navigate(['/product/return'], {\n\t\t\t\tskipLocationChange: false,\n\t\t\t});\n\t\t} else {\n\t\t\tthis.router.navigateByUrl('/product/get', {\n\t\t\t\tskipLocationChange: false,\n\t\t\t});\n\t\t}\n\n\t\tthis.unselectDriveToWarehouseFrom();\n\t\tthis.unsubscribeAll();\n\t}\n\n\tasync cancelWork() {\n\t\tif (this.fromDelivery) {\n\t\t\tthis.unselectDriveToWarehouseFrom();\n\t\t\tthis.router.navigateByUrl('/main/delivery', {\n\t\t\t\tskipLocationChange: true,\n\t\t\t});\n\t\t} else {\n\t\t\tif (this.carrier && this.selectedOrder) {\n\t\t\t\tawait this.carrierOrdersRouter.cancelDelivery(\n\t\t\t\t\tthis.carrier['id'],\n\t\t\t\t\t[this.selectedOrder['id']]\n\t\t\t\t);\n\t\t\t\tthis.unselectOrder();\n\t\t\t}\n\t\t}\n\t}\n\n\tionViewWillLeave() {\n\t\tthis.unselectDriveToWarehouseFrom();\n\t\tthis.unsubscribeAll();\n\t}\n\n\tunselectOrder() {\n\t\tthis.store.selectedOrder = null;\n\t\tlocalStorage.removeItem('orderId');\n\t\tthis.navCtrl.navigateRoot('/main/home');\n\t}\n\n\tprivate unsubscribeAll() {\n\t\tif (this.carrier$) {\n\t\t\tthis.carrier$.unsubscribe();\n\t\t}\n\t\tif (this.order$) {\n\t\t\tthis.order$.unsubscribe();\n\t\t}\n\t}\n\n\tprivate unselectDriveToWarehouseFrom() {\n\t\tlocalStorage.removeItem('driveToWarehouseFrom');\n\t}\n}\n"],"sourceRoot":"webpack:///"}