{"version":3,"sources":["./src/pages/main/delivery/delivery.html","./src/pages/main/delivery/delivery.module.ts","./src/pages/main/delivery/delivery.ts"],"names":[],"mappings":"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","file":"delivery-delivery-module.js","sourcesContent":["export default \"<div\\n\\tclass=\\\"money-amount-container\\\"\\n\\t*ngIf=\\\"!selectedOrder?.isPaid && !selectedOrder?. isCancelled\\\"\\n>\\n\\t<div class=\\\"money-amount\\\">\\n\\t\\t{{ 'DELIVERY_VIEW.THE_CUSTOMER_HAS_TO_PAY' | translate }} ${{\\n\\t\\tselectedOrder?.totalPrice }}!\\n\\t</div>\\n</div>\\n\\n<div\\n\\tclass=\\\"already-paid-container\\\"\\n\\t*ngIf=\\\"selectedOrder?.isPaid && !selectedOrder?. isCancelled\\\"\\n>\\n\\t<div class=\\\"already-paid\\\">\\n\\t\\t{{ 'DELIVERY_VIEW.CUSTOMER_ALREADY_PAID_WITH_CARD' | translate }}\\n\\t</div>\\n</div>\\n\\n<carrier-map #map class=\\\"map\\\"></carrier-map>\\n\\n<div class=\\\"bottom-container\\\">\\n\\t<div class=\\\"info\\\">\\n\\t\\t<span class=\\\"left-info\\\">{{ selectedOrder?.user.fullAddress }}</span>\\n\\t\\t<span *ngIf=\\\"carrierUserDistance\\\" class=\\\"right-text\\\"\\n\\t\\t\\t>{{ carrierUserDistance + 'km' }}</span\\n\\t\\t>\\n\\t</div>\\n\\n\\t<div class=\\\"buttons\\\">\\n\\t\\t<div class=\\\"button-bar\\\">\\n\\t\\t\\t<button\\n\\t\\t\\t\\t*ngIf=\\\"!selectedOrder?.isCancelled\\\"\\n\\t\\t\\t\\t[disabled]=\\\"disabledButtons\\\"\\n\\t\\t\\t\\tclass=\\\"button button-brand\\\"\\n\\t\\t\\t\\t(click)=\\\"delivered()\\\"\\n\\t\\t\\t>\\n\\t\\t\\t\\t{{ 'DELIVERY_VIEW.DELIVERED' | translate }}\\n\\t\\t\\t</button>\\n\\n\\t\\t\\t<button\\n\\t\\t\\t\\t[disabled]=\\\"disabledButtons\\\"\\n\\t\\t\\t\\tclass=\\\"button button-assertive\\\"\\n\\t\\t\\t\\t(click)=\\\"cancel()\\\"\\n\\t\\t\\t>\\n\\t\\t\\t\\t<span *ngIf=\\\"!selectedOrder?.isCancelled\\\"\\n\\t\\t\\t\\t\\t>{{ 'DELIVERY_VIEW.CANCEL' | translate }}</span\\n\\t\\t\\t\\t>\\n\\t\\t\\t\\t<span *ngIf=\\\"selectedOrder?.isCancelled\\\"\\n\\t\\t\\t\\t\\t>{{ 'OK' | translate }}</span\\n\\t\\t\\t\\t>\\n\\t\\t\\t</button>\\n\\t\\t</div>\\n\\t</div>\\n</div>\\n\"","import { NgModule } from '@angular/core';\n\nimport { DeliveryPage } from './delivery';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { Geolocation } from '@ionic-native/geolocation/ngx';\nimport { GeoLocationService } from '../../../services/geo-location.service';\nimport { Routes, RouterModule } from '@angular/router';\nimport { CommonModule } from '@angular/common';\nimport { MapModule } from '../common/map/map.module';\n\nconst routes: Routes = [\n\t{\n\t\tpath: '',\n\t\tcomponent: DeliveryPage,\n\t},\n];\n\n@NgModule({\n\tdeclarations: [DeliveryPage],\n\timports: [\n\t\tCommonModule,\n\t\tTranslateModule.forChild(),\n\t\tRouterModule.forChild(routes),\n\t\tMapModule,\n\t],\n\tproviders: [Geolocation, GeoLocationService],\n})\nexport class DeliveryPageModule {}\n","import { Component, ViewChild, AfterViewInit, OnDestroy } from '@angular/core';\nimport IOrder from '@modules/server.common/interfaces/IOrder';\nimport { OrderRouter } from '@modules/client.common.angular2/routers/order-router.service';\nimport OrderCarrierStatus from '@modules/server.common/enums/OrderCarrierStatus';\nimport { Mixpanel } from '@ionic-native/mixpanel/ngx';\nimport Utils from '@modules/server.common/utils';\nimport { Geolocation } from '@ionic-native/geolocation/ngx';\nimport IGeoLocation from '@modules/server.common/interfaces/IGeoLocation';\nimport GeoLocation from '@modules/server.common/entities/GeoLocation';\nimport { GeoLocationService } from '../../../services/geo-location.service';\nimport { MapComponent } from '../common/map/map.component';\nimport { Router } from '@angular/router';\nimport { Store } from 'services/store.service';\nimport { takeUntil } from 'rxjs/operators';\nimport { Subject } from 'rxjs';\n\ndeclare var google: any;\n\n@Component({\n\tselector: 'page-delivery',\n\ttemplateUrl: 'delivery.html',\n})\nexport class DeliveryPage implements AfterViewInit, OnDestroy {\n\t@ViewChild('map')\n\tcarrierMap: MapComponent;\n\n\tselectedOrder: IOrder;\n\tcarrierUserDistance: string;\n\tdisabledButtons: boolean = true;\n\n\tprivate destroy$ = new Subject<void>();\n\n\tget fullAddress() {\n\t\treturn this.selectedOrder.user.fullAddress;\n\t}\n\n\tconstructor(\n\t\tprivate orderRouter: OrderRouter,\n\t\tprivate mixpanel: Mixpanel,\n\t\tprivate geoLocationService: GeoLocationService,\n\t\tprivate geolocation: Geolocation,\n\t\tprivate router: Router,\n\t\tprivate store: Store\n\t) {}\n\n\tasync delivered() {\n\t\tthis.disabledButtons = true;\n\t\tif (this.selectedOrder) {\n\t\t\tthis.router.navigateByUrl('/main/home', {\n\t\t\t\tskipLocationChange: false,\n\t\t\t});\n\n\t\t\tthis.unselectOrder();\n\n\t\t\tawait this.orderRouter.updateCarrierStatus(\n\t\t\t\tthis.selectedOrder['id'],\n\t\t\t\tOrderCarrierStatus.DeliveryCompleted\n\t\t\t);\n\n\t\t\tthis.mixpanel.track('Order Delivered');\n\t\t} else {\n\t\t\talert('Try again!');\n\t\t}\n\t\tthis.disabledButtons = false;\n\t}\n\n\tcancel() {\n\t\tthis.disabledButtons = true;\n\t\tthis.store.driveToWarehouseFrom = 'delivery';\n\t\tthis.router.navigateByUrl('/main/drive-to-warehouse', {\n\t\t\tskipLocationChange: false,\n\t\t});\n\t}\n\n\tngAfterViewInit(): void {\n\t\tthis.loadData();\n\t}\n\n\tionViewWillEnter() {}\n\n\tionViewWillLeave() {}\n\n\tprivate unselectOrder() {\n\t\tlocalStorage.removeItem('orderId');\n\t\tthis.store.selectedOrder = null;\n\t}\n\n\tprivate loadData() {\n\t\tthis.orderRouter\n\t\t\t.get(localStorage.getItem('orderId'), { populateWarehouse: true })\n\t\t\t.pipe(takeUntil(this.destroy$))\n\t\t\t.subscribe(async (order) => {\n\t\t\t\tthis.selectedOrder = order;\n\t\t\t\tthis.store.selectedOrder = order;\n\t\t\t\t// const carrier = await this.carrierRouter\n\t\t\t\t// \t.get(order.carrierId)\n\t\t\t\t// \t.pipe(first())\n\t\t\t\t// \t.toPromise();\n\n\t\t\t\tconst position = this.geoLocationService.defaultLocation()\n\t\t\t\t\t? this.geoLocationService.defaultLocation()\n\t\t\t\t\t: await this.geolocation.getCurrentPosition();\n\n\t\t\t\t// MongoDb store coordinates lng => lat\n\t\t\t\tconst dbGeoInput = {\n\t\t\t\t\tloc: {\n\t\t\t\t\t\ttype: 'Point',\n\t\t\t\t\t\tcoordinates: [\n\t\t\t\t\t\t\tposition.coords.longitude,\n\t\t\t\t\t\t\tposition.coords.latitude,\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t} as IGeoLocation;\n\n\t\t\t\tconst origin = new google.maps.LatLng(\n\t\t\t\t\tposition.coords.latitude,\n\t\t\t\t\tposition.coords.longitude\n\t\t\t\t);\n\t\t\t\tconst userGeo = order.user['geoLocation'];\n\n\t\t\t\tthis.carrierUserDistance = Utils.getDistance(\n\t\t\t\t\tuserGeo,\n\t\t\t\t\tdbGeoInput as GeoLocation\n\t\t\t\t).toFixed(2);\n\n\t\t\t\tconst destination = new google.maps.LatLng(\n\t\t\t\t\tuserGeo.loc.coordinates[1],\n\t\t\t\t\tuserGeo.loc.coordinates[0]\n\t\t\t\t);\n\n\t\t\t\tthis.carrierMap.setCenter(origin);\n\t\t\t\tthis.carrierMap.drawRoute(origin, destination);\n\t\t\t\tthis.disabledButtons = false;\n\t\t\t});\n\t}\n\n\tngOnDestroy(): void {\n\t\tthis.destroy$.next();\n\t\tthis.destroy$.complete();\n\t}\n}\n"],"sourceRoot":"webpack:///"}