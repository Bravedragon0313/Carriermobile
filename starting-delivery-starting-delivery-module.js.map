{"version":3,"sources":["./src/pages/main/starting-delivery/starting-delivery.html","./src/pages/main/starting-delivery/starting-delivery.module.ts","./src/pages/main/starting-delivery/starting-delivery.ts"],"names":[],"mappings":"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","file":"starting-delivery-starting-delivery-module.js","sourcesContent":["export default \"<carrier-map #map class=\\\"map\\\"></carrier-map>\\n\\n<div class=\\\"bottom-container\\\">\\n\\t<div class=\\\"info\\\">\\n\\t\\t<span class=\\\"left-info\\\">{{ selectedOrder?.user.fullAddress }}</span>\\n\\t\\t<span *ngIf=\\\"carrierUserDistance\\\" class=\\\"right-text\\\"\\n\\t\\t\\t>{{ carrierUserDistance + 'km' }}</span\\n\\t\\t>\\n\\t</div>\\n\\n\\t<div class=\\\"buttons\\\">\\n\\t\\t<div class=\\\"button-bar\\\">\\n\\t\\t\\t<button\\n\\t\\t\\t\\t*ngIf=\\\"!selectedOrder?.isCancelled\\\"\\n\\t\\t\\t\\t[disabled]=\\\"disabledButtons\\\"\\n\\t\\t\\t\\tclass=\\\"button button-brand\\\"\\n\\t\\t\\t\\t(click)=\\\"startDelivery()\\\"\\n\\t\\t\\t>\\n\\t\\t\\t\\t{{ 'STARTING_DELIVERY_VIEW.START' | translate }}\\n\\t\\t\\t</button>\\n\\n\\t\\t\\t<button\\n\\t\\t\\t\\t[ngSwitch]=\\\"selectedOrder?.isCancelled\\\"\\n\\t\\t\\t\\t[disabled]=\\\"disabledButtons\\\"\\n\\t\\t\\t\\tclass=\\\"button button-assertive\\\"\\n\\t\\t\\t\\t(click)=\\\"returnProduct()\\\"\\n\\t\\t\\t>\\n\\t\\t\\t\\t<span *ngSwitchCase=\\\"false\\\"\\n\\t\\t\\t\\t\\t>{{ 'STARTING_DELIVERY_VIEW.CANCEL' | translate }}</span\\n\\t\\t\\t\\t>\\n\\t\\t\\t\\t<span *ngSwitchCase=\\\"true\\\">{{ 'OK' | translate }}</span>\\n\\t\\t\\t</button>\\n\\t\\t</div>\\n\\t</div>\\n</div>\\n\"","import { NgModule } from '@angular/core';\nimport { StartingDeliveryPage } from './starting-delivery';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { Routes, RouterModule } from '@angular/router';\nimport { MapModule } from '../common/map/map.module';\nimport { CommonModule } from '@angular/common';\n\nconst routes: Routes = [\n\t{\n\t\tpath: '',\n\t\tcomponent: StartingDeliveryPage,\n\t},\n];\n\n@NgModule({\n\tdeclarations: [StartingDeliveryPage],\n\timports: [\n\t\tCommonModule,\n\t\tRouterModule.forChild(routes),\n\t\tTranslateModule.forChild(),\n\t\tMapModule,\n\t],\n})\nexport class StartingDeliveryPageModule {}\n","import { Component, ViewChild, AfterViewInit, OnDestroy } from '@angular/core';\nimport { MapComponent } from '../common/map/map.component';\nimport { OrderRouter } from '@modules/client.common.angular2/routers/order-router.service';\nimport IOrder from '@modules/server.common/interfaces/IOrder';\nimport { Router } from '@angular/router';\nimport { first, takeUntil } from 'rxjs/operators';\nimport { GeoLocationService } from 'services/geo-location.service';\nimport GeoLocation from '@modules/server.common/entities/GeoLocation';\nimport { Geolocation } from '@ionic-native/geolocation/ngx';\nimport IGeoLocation from '@modules/server.common/interfaces/IGeoLocation';\nimport Utils from '@modules/server.common/utils';\nimport { CarrierOrdersRouter } from '@modules/client.common.angular2/routers/carrier-orders-router.service';\nimport { Store } from 'services/store.service';\nimport OrderCarrierStatus from '@modules/server.common/enums/OrderCarrierStatus';\nimport { Subject } from 'rxjs';\n\n@Component({\n\tselector: 'page-starting-delivery',\n\ttemplateUrl: 'starting-delivery.html',\n})\nexport class StartingDeliveryPage implements AfterViewInit, OnDestroy {\n\t@ViewChild('map')\n\tcarrierMap: MapComponent;\n\n\tselectedOrder: IOrder;\n\tcarrierUserDistance: string;\n\tdisabledButtons: boolean = true;\n\n\tprivate destroy$ = new Subject<void>();\n\n\tconstructor(\n\t\tprivate orderRouter: OrderRouter,\n\t\tprivate carrierOrdersRouter: CarrierOrdersRouter,\n\t\tprivate geoLocationService: GeoLocationService,\n\t\tprivate geolocation: Geolocation,\n\t\tprivate router: Router,\n\t\tprivate store: Store\n\t) {}\n\n\tngAfterViewInit(): void {\n\t\tthis.loadData();\n\t}\n\n\tionViewWillEnter() {\n\t\tthis.loadData();\n\t}\n\n\tasync startDelivery() {\n\t\tthis.disabledButtons = true;\n\t\tawait this.carrierOrdersRouter.updateStatus(\n\t\t\tthis.store.carrierId,\n\t\t\tOrderCarrierStatus.CarrierStartDelivery\n\t\t);\n\n\t\tthis.router.navigateByUrl('/main/delivery', {\n\t\t\tskipLocationChange: false,\n\t\t});\n\t\tthis.disabledButtons = false;\n\t}\n\n\treturnProduct() {\n\t\tthis.disabledButtons = true;\n\t\tthis.store.returnProductFrom = 'startingDelivery';\n\n\t\tthis.router.navigateByUrl('/product/return', {\n\t\t\tskipLocationChange: false,\n\t\t});\n\t\tthis.disabledButtons = false;\n\t}\n\n\tprivate loadData() {\n\t\tthis.orderRouter\n\t\t\t.get(localStorage.getItem('orderId'), { populateWarehouse: true })\n\t\t\t.pipe(takeUntil(this.destroy$))\n\t\t\t.subscribe(async (order) => {\n\t\t\t\tthis.selectedOrder = order;\n\t\t\t\tthis.store.selectedOrder = order;\n\n\t\t\t\tconst position = this.geoLocationService.defaultLocation()\n\t\t\t\t\t? this.geoLocationService.defaultLocation()\n\t\t\t\t\t: await this.geolocation.getCurrentPosition();\n\n\t\t\t\t// MongoDb store coordinates lng => lat\n\t\t\t\tconst dbGeoInput = {\n\t\t\t\t\tloc: {\n\t\t\t\t\t\ttype: 'Point',\n\t\t\t\t\t\tcoordinates: [\n\t\t\t\t\t\t\tposition.coords.longitude,\n\t\t\t\t\t\t\tposition.coords.latitude,\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t} as IGeoLocation;\n\n\t\t\t\tconst origin = new google.maps.LatLng(\n\t\t\t\t\tposition.coords.latitude,\n\t\t\t\t\tposition.coords.longitude\n\t\t\t\t);\n\n\t\t\t\tconst userGeo = this.selectedOrder.user['geoLocation'];\n\n\t\t\t\tthis.carrierUserDistance = Utils.getDistance(\n\t\t\t\t\tuserGeo as GeoLocation,\n\t\t\t\t\tdbGeoInput as GeoLocation\n\t\t\t\t).toFixed(2);\n\n\t\t\t\tconst destination = new google.maps.LatLng(\n\t\t\t\t\tuserGeo.loc.coordinates[1],\n\t\t\t\t\tuserGeo.loc.coordinates[0]\n\t\t\t\t);\n\n\t\t\t\tthis.carrierMap.setCenter(origin);\n\t\t\t\tthis.carrierMap.drawRoute(origin, destination);\n\n\t\t\t\tthis.disabledButtons = false;\n\t\t\t});\n\t}\n\n\tngOnDestroy(): void {\n\t\tthis.destroy$.next();\n\t\tthis.destroy$.complete();\n\t}\n}\n"],"sourceRoot":"webpack:///"}